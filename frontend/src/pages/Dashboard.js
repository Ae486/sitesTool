import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useQuery } from "@tanstack/react-query";
import { Card, Col, List, Row, Statistic, Tag, Typography } from "antd";
import { motion } from "framer-motion";
import { fetchFlows } from "../api/flows";
import { fetchSites } from "../api/sites";
import { containerVariants, itemVariants } from "../constants/animations";
const DashboardPage = () => {
    const { data: sites } = useQuery({ queryKey: ["sites"], queryFn: fetchSites });
    const { data: flows } = useQuery({ queryKey: ["flows"], queryFn: fetchFlows });
    const siteItems = sites?.items ?? [];
    const flowItems = flows?.items ?? [];
    const successfulFlows = flowItems.filter((flow) => flow.last_status === "success").length;
    return (_jsxs(motion.div, { variants: containerVariants, initial: "hidden", animate: "show", style: { display: "flex", flexDirection: "column", gap: 24 }, children: [_jsxs(Row, { gutter: [24, 24], children: [_jsx(Col, { span: 8, children: _jsx(motion.div, { variants: itemVariants, children: _jsx(Card, { className: "glass-card", bordered: false, children: _jsx(Statistic, { title: _jsx("span", { style: { color: "var(--text-secondary)" }, children: "\u5DF2\u914D\u7F6E\u7AD9\u70B9" }), value: sites?.total ?? 0, valueStyle: { color: "var(--primary-color)", fontWeight: "bold" } }) }) }) }), _jsx(Col, { span: 8, children: _jsx(motion.div, { variants: itemVariants, children: _jsx(Card, { className: "glass-card", bordered: false, children: _jsx(Statistic, { title: _jsx("span", { style: { color: "var(--text-secondary)" }, children: "\u81EA\u52A8\u5316\u6D41\u7A0B" }), value: flows?.total ?? 0, valueStyle: { color: "var(--secondary-color)", fontWeight: "bold" } }) }) }) }), _jsx(Col, { span: 8, children: _jsx(motion.div, { variants: itemVariants, children: _jsx(Card, { className: "glass-card", bordered: false, children: _jsx(Statistic, { title: _jsx("span", { style: { color: "var(--text-secondary)" }, children: "\u4ECA\u65E5\u6210\u529F\u6D41\u7A0B" }), value: successfulFlows, suffix: _jsxs("span", { style: { fontSize: "14px", color: "var(--text-secondary)" }, children: ["/ ", flows?.total ?? 0] }), valueStyle: { color: "var(--success-color)", fontWeight: "bold" } }) }) }) })] }), _jsxs(Row, { gutter: [24, 24], children: [_jsx(Col, { span: 12, children: _jsx(motion.div, { variants: itemVariants, style: { height: "100%" }, children: _jsx(Card, { title: "\u7AD9\u70B9\u6700\u8FD1\u6DFB\u52A0", className: "glass-card", bordered: false, style: { height: "100%" }, headStyle: { borderBottom: "1px solid rgba(0,0,0,0.05)" }, children: _jsx(List, { dataSource: siteItems.slice(0, 5), renderItem: (item) => (_jsx(List.Item, { style: { padding: "12px 0", borderBottom: "1px solid rgba(0,0,0,0.05)" }, children: _jsxs("div", { style: { display: "flex", flexDirection: "column", width: "100%" }, children: [_jsxs("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" }, children: [_jsx(Typography.Text, { strong: true, style: { fontSize: "16px" }, children: item.name }), _jsx("div", { style: { display: "flex", gap: 4 }, children: item.tags.map((tag) => (_jsx(Tag, { color: tag.color || "blue", style: { margin: 0 }, children: tag.name }, tag.id))) })] }), _jsx(Typography.Link, { href: item.url, target: "_blank", rel: "noreferrer", style: { color: "var(--text-secondary)", marginTop: 4 }, children: item.url })] }) })) }) }) }) }), _jsx(Col, { span: 12, children: _jsx(motion.div, { variants: itemVariants, style: { height: "100%" }, children: _jsx(Card, { title: "\u6D41\u7A0B\u961F\u5217", className: "glass-card", bordered: false, style: { height: "100%" }, headStyle: { borderBottom: "1px solid rgba(0,0,0,0.05)" }, children: _jsx(List, { dataSource: flowItems.slice(0, 5), renderItem: (item) => (_jsx(List.Item, { style: { padding: "12px 0", borderBottom: "1px solid rgba(0,0,0,0.05)" }, children: _jsxs("div", { style: { display: "flex", flexDirection: "column", width: "100%" }, children: [_jsxs("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" }, children: [_jsx(Typography.Text, { strong: true, style: { fontSize: "16px" }, children: item.name }), _jsx(Tag, { color: item.last_status === "success"
                                                                ? "success"
                                                                : item.last_status === "failed"
                                                                    ? "error"
                                                                    : "default", children: item.last_status || "未执行" })] }), _jsxs(Typography.Text, { type: "secondary", style: { marginTop: 4 }, children: ["\u8C03\u5EA6\uFF1A", item.cron_expression || "手动触发"] })] }) })) }) }) }) })] })] }));
};
export default DashboardPage;
